Refactor plan complete. All steps implemented and typechecked.
